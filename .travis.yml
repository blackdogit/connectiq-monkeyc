language: java
script:
  - #echo "=== set ==="
  - #set
  - #echo "=== export ==="
  - #export
  - mvn -Pci -Dbuild.number=$"{TRAVIS_BUILD_NUMBER}" -Dbuild.branch=$"{TRAVIS_BRANCH}" clean verify -f com.blackdogit.connectiq.monkeyc.root/pom.xml
install: true
notifications:
  email:
    recipients:
    - tonny.madsen@blackdogit.com
before_install:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
after_failure:
  - echo "=== SUREFIRE REPORTS ==="
  - for F in com.blackdogit.connectiq.*/target/surefire-reports/*.txt; do echo $F && cat $F && echo; done
  - echo "=== *log* ==="
  - find . -type f -name "*log*" | while read f; do echo ">> $f"; cat "$f"; done
after_success:
  - echo "=== set ==="
  - set
  - echo "=== export ==="
  - export
  - MC_DIR="$(pwd)"
  - PAGES_DIR=/usr/tmp/pages
  - git clone -b gh-pages https://github.com/blackdogit/connectiq-monkeyc.git "$[PAGES_DIR]"
  - cd "${PAGES_DIR}"
  - git config credential.helper "store --file="${PAGES_DIR}/.git/credentials"
  - echo "https://${GH_TOKEN}:@github.com" > "${PAGES_DIR}/.git/credentials"
  - rm -rf "${PAGES_DIR}/a"/*
  - cp -r "${MC_DIR}/com.blackdogit.connectiq.monkeyc.site/target/repository" "${PAGES_DIR}/a"
  - ls -Rl "${PAGES_DIR}"
env:
  global:
    secure: LZgkK1L6/gIDbGM4o2YIUWK0VpbjMA9KUGk77IO7jNqeRKjuFa8I1De92+LtGcTcALqThRRAUzgB68XG4LE3Eo9i9PUEwzSjQIiTWdtZlErCz368SljZz2ocIHhd6vIeOVkElTV8S9LVaOlKBmji3HhcaIfK6KUZR43Pgy4qc7Y=
